<div class="flex justify-between mb-6">
    <h1 class="text-xl lg:text-2xl font-bold">{{Messages.Headers.myProjects}}</h1>

    <!-- Add Project Button -->
    <div class="flex justify-start mb-2">
        <button (click)="onAddClick()" *ngIf="projectList.canAddProject"
            class="flex flex-row cursor-pointer items-center justify-center px-4 py-2 text-sm font-medium text-center bg-custom-500 text-white rounded-lg hover:bg-custom-600">
            <svg class="shrink-0 w-5 h-5 ml-3 mb-0" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                stroke="#ffffff">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                    <path
                        d="M12.75 9C12.75 8.58579 12.4142 8.25 12 8.25C11.5858 8.25 11.25 8.58579 11.25 9L11.25 11.25H9C8.58579 11.25 8.25 11.5858 8.25 12C8.25 12.4142 8.58579 12.75 9 12.75H11.25V15C11.25 15.4142 11.5858 15.75 12 15.75C12.4142 15.75 12.75 15.4142 12.75 15L12.75 12.75H15C15.4142 12.75 15.75 12.4142 15.75 12C15.75 11.5858 15.4142 11.25 15 11.25H12.75V9Z"
                        fill="#ffffff"></path>
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M12 1.25C6.06294 1.25 1.25 6.06294 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 6.06294 17.9371 1.25 12 1.25ZM2.75 12C2.75 6.89137 6.89137 2.75 12 2.75C17.1086 2.75 21.25 6.89137 21.25 12C21.25 17.1086 17.1086 21.25 12 21.25C6.89137 21.25 2.75 17.1086 2.75 12Z"
                        fill="#ffffff"></path>
                </g>
            </svg>
            {{Messages.Buttons.addProject}}
        </button>
    </div>
</div>

<!-- Summary Cards -->
<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
    <!-- Total Projects Card -->
    <div class="flex items-center p-4 bg-white rounded-xl shadow-sm border border-gray-200 justify-center">
        <div class="flex items-center justify-center w-12 h-12 rounded-full bg-custom-400 text-custom-600">
            <svg class="w-7 h-7" fill="#ffffff" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"
                stroke="#ffffff" stroke-width="10.24">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                    <path
                        d="M136.948 908.811c5.657 0 10.24-4.583 10.24-10.24V610.755c0-5.657-4.583-10.24-10.24-10.24h-81.92a10.238 10.238 0 00-10.24 10.24v287.816c0 5.657 4.583 10.24 10.24 10.24h81.92zm0 40.96h-81.92c-28.278 0-51.2-22.922-51.2-51.2V610.755c0-28.278 22.922-51.2 51.2-51.2h81.92c28.278 0 51.2 22.922 51.2 51.2v287.816c0 28.278-22.922 51.2-51.2 51.2zm278.414-40.96c5.657 0 10.24-4.583 10.24-10.24V551.322c0-5.657-4.583-10.24-10.24-10.24h-81.92a10.238 10.238 0 00-10.24 10.24v347.249c0 5.657 4.583 10.24 10.24 10.24h81.92zm0 40.96h-81.92c-28.278 0-51.2-22.922-51.2-51.2V551.322c0-28.278 22.922-51.2 51.2-51.2h81.92c28.278 0 51.2 22.922 51.2 51.2v347.249c0 28.278-22.922 51.2-51.2 51.2zm278.414-40.342c5.657 0 10.24-4.583 10.24-10.24V492.497c0-5.651-4.588-10.24-10.24-10.24h-81.92c-5.652 0-10.24 4.589-10.24 10.24v406.692c0 5.657 4.583 10.24 10.24 10.24h81.92zm0 40.96h-81.92c-28.278 0-51.2-22.922-51.2-51.2V492.497c0-28.271 22.924-51.2 51.2-51.2h81.92c28.276 0 51.2 22.929 51.2 51.2v406.692c0 28.278-22.922 51.2-51.2 51.2zm278.414-40.958c5.657 0 10.24-4.583 10.24-10.24V441.299c0-5.657-4.583-10.24-10.24-10.24h-81.92a10.238 10.238 0 00-10.24 10.24v457.892c0 5.657 4.583 10.24 10.24 10.24h81.92zm0 40.96h-81.92c-28.278 0-51.2-22.922-51.2-51.2V441.299c0-28.278 22.922-51.2 51.2-51.2h81.92c28.278 0 51.2 22.922 51.2 51.2v457.892c0 28.278-22.922 51.2-51.2 51.2zm-6.205-841.902C677.379 271.088 355.268 367.011 19.245 387.336c-11.29.683-19.889 10.389-19.206 21.679s10.389 19.889 21.679 19.206c342.256-20.702 670.39-118.419 964.372-284.046 9.854-5.552 13.342-18.041 7.79-27.896s-18.041-13.342-27.896-7.79z">
                    </path>
                    <path
                        d="M901.21 112.64l102.39.154c11.311.017 20.494-9.138 20.511-20.449s-9.138-20.494-20.449-20.511l-102.39-.154c-11.311-.017-20.494 9.138-20.511 20.449s9.138 20.494 20.449 20.511z">
                    </path>
                    <path
                        d="M983.151 92.251l-.307 101.827c-.034 11.311 9.107 20.508 20.418 20.542s20.508-9.107 20.542-20.418l.307-101.827c.034-11.311-9.107-20.508-20.418-20.542s-20.508 9.107-20.542 20.418z">
                    </path>
                </g>
            </svg>
        </div>
        <div class="mr-4">
            <div class="text-sm text-gray-500 font-medium">{{ Messages.Labels.totalProjectCount }}</div>
            <div class="text-lg font-semibold text-gray-800">{{ projectList.totalProjectCount }}</div>
        </div>
    </div>

    <!-- Total Projects Purchased Card -->
    <div class="flex items-center p-4 bg-white rounded-xl shadow-sm border border-gray-200 justify-center">
        <div class="flex items-center justify-center w-12 h-12 rounded-full bg-custom-300 text-custom-600">
            <svg class="w-8 h-8" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" fill="#7A65E5"
                stroke="#7A65E5" stroke-width="10.24">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC"
                    stroke-width="6.144"></g>
                <g id="SVGRepo_iconCarrier">
                    <path fill="#7A65E5"
                        d="M704 288h131.072a32 32 0 0 1 31.808 28.8L886.4 512h-64.384l-16-160H704v96a32 32 0 1 1-64 0v-96H384v96a32 32 0 0 1-64 0v-96H217.92l-51.2 512H512v64H131.328a32 32 0 0 1-31.808-35.2l57.6-576a32 32 0 0 1 31.808-28.8H320v-22.336C320 154.688 405.504 64 512 64s192 90.688 192 201.664v22.4zm-64 0v-22.336C640 189.248 582.272 128 512 128c-70.272 0-128 61.248-128 137.664v22.4h256zm201.408 483.84L768 698.496V928a32 32 0 1 1-64 0V698.496l-73.344 73.344a32 32 0 1 1-45.248-45.248l128-128a32 32 0 0 1 45.248 0l128 128a32 32 0 1 1-45.248 45.248z">
                    </path>
                </g>
            </svg>
        </div>
        <div class="mr-4">
            <div class="text-sm text-gray-500 font-medium">{{ Messages.Labels.totalPurchaseCount }}</div>
            <div class="text-lg font-semibold text-gray-800">{{ projectList.totalPurchaseCount }}</div>
        </div>
    </div>

    <!-- Total Income Card -->
    <div class="flex items-center p-4 bg-white rounded-xl shadow-sm border border-gray-200 justify-center">
        <div class="flex items-center justify-center w-12 h-12 rounded-full bg-custom-400 text-custom-600">
            <svg class="w-7 h-7" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="#ffffff"
                stroke="#ffffff" stroke-width="5.12">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                    <style type="text/css">
                        .st0 {
                            fill: #ffffff;
                        }
                    </style>
                    <g>
                        <path class="st0"
                            d="M314.176,370.453c-3.25,6.094-7.719,11.188-13.375,15.344c-5.672,4.156-12.469,7.25-20.359,9.281 c-3.453,0.875-7.063,1.484-10.734,1.984v22.984H242.27v-22.531c-7.813-0.656-15.281-1.875-22.313-3.813 c-10.734-2.938-24.797-14.813-24.797-14.813c-1.203-0.703-2-1.938-2.172-3.313s0.297-2.766,1.281-3.75l13.75-13.75 c1.484-1.469,3.781-1.75,5.563-0.656c0,0,10.281,8.938,18.078,11.063s15.531,3.188,23.25,3.188c9.734,0,17.781-1.719,24.156-5.156 c6.391-3.469,9.578-8.813,9.578-16.125c0-5.266-1.563-9.422-4.719-12.469c-3.141-3.031-8.453-4.938-15.953-5.766l-24.625-2.125 c-14.578-1.422-25.828-5.484-33.719-12.156c-7.922-6.688-11.859-16.828-11.859-30.391c0-7.5,1.516-14.188,4.563-20.047 c3.047-5.875,7.188-10.844,12.453-14.906c5.266-4.031,11.406-7.094,18.391-9.094c2.922-0.844,5.984-1.406,9.094-1.906v-19.813 h27.438v19.406c6.406,0.625,12.5,1.656,18.172,3.219c9.625,2.625,19.734,10.531,19.734,10.531c1.266,0.656,2.125,1.875,2.344,3.281 c0.219,1.438-0.25,2.844-1.25,3.875l-12.891,13.078c-1.375,1.391-3.5,1.75-5.25,0.844c0,0-7.641-5.438-14.234-7.156 c-6.594-1.703-13.516-2.578-20.813-2.578c-9.531,0-16.578,1.813-21.125,5.453c-4.563,3.656-6.828,8.422-6.828,14.281 c0,5.281,1.594,9.328,4.859,12.156c3.234,2.844,8.703,4.688,16.406,5.469l21.578,1.844c16,1.406,28.109,5.656,36.313,12.75 c8.219,7.094,12.313,17.438,12.313,31C319.035,357.297,317.41,364.375,314.176,370.453z">
                        </path>
                        <path class="st0"
                            d="M476.238,174.75c2.188-8.563-2.969-17.281-11.531-19.5l-57.563-14.781l50.609-27.672 c7.75-4.234,10.594-13.953,6.344-21.703c-4.234-7.75-13.953-10.609-21.703-6.359l-64.063,35.047l39.203-95.25 c0.484-1.156,0.453-2.469-0.063-3.609c-0.531-1.141-1.5-2.016-2.703-2.422c0,0-31.672-16.438-49.578-16.438 c-37.063,0-73.063,19.422-105.828,19.422c-9.922,0-19.547-1.781-28.797-6.422C208.801,4.188,189.801,0,171.816,0 C144.66,0,96.52,18.766,96.52,18.766c-1.266,0.328-2.344,1.172-2.938,2.359c-0.594,1.172-0.656,2.563-0.156,3.781l43.188,104.859 c-5.328,2.609-9.016,8.016-9.016,14.328c0,5.438,2.734,10.25,6.891,13.125c-21.109,25.156-73.156,92.563-92.75,167.031 C13.457,431.703,76.52,512,255.41,512s241.953-80.297,213.672-187.75c-17.281-65.688-59.813-125.875-84.094-156.438l71.766,18.438 C465.316,188.469,474.035,183.313,476.238,174.75z M171.816,40c13.078,0,26.063,3.453,40.859,10.844 c14.109,7.063,29.813,10.641,46.688,10.641c21.266,0,41.078-5.438,60.234-10.688c16.391-4.484,31.875-8.734,45.594-8.734 l1.859,0.031l-35.406,86H179.16l-34.547-83.969C154.113,41.563,163.035,40,171.816,40z M419.816,421.094 C394.504,453.922,336.113,472,255.41,472c-80.719,0-139.094-18.078-164.406-50.906C74.488,399.656,70.926,370.5,80.41,334.438 c21.906-83.25,91.844-159.75,92.516-160.5l12.844-13.844h139.266l12.844,13.844c0.703,0.781,70.484,76.719,92.516,160.5 C439.895,370.5,436.332,399.656,419.816,421.094z">
                        </path>
                    </g>
                </g>
            </svg>
        </div>
        <div class="mr-4">
            <div class="text-sm text-gray-500 font-medium">{{ Messages.Labels.totalProjectIncome }}</div>
            <div class="text-lg font-semibold text-gray-800">{{ projectList.totalProjectIncome | number:'1.0-0' }}<span
                    class="mr-1">{{ Messages.Headers.toman }}</span></div>
        </div>
    </div>
</div>

<div *ngIf="!projectList.userProjects || projectList.userProjects.length == 0; else showProjects">
    <div class="w-full my-10">
        <div class="w-full bg-custom-400/40 rounded-xl py-4 text-md flex items-center justify-center gap-2">
            <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z" />
            </svg>
            {{ Messages.Warnings.noProjectsYet }}
        </div>
    </div>
</div>

<ng-template #showProjects>
    <!-- Projects Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div *ngFor="let project of projectList.userProjects" class="flex flex-col justify-between">
            <hw-project-card [project]="project" (edit)="onEditClick($event)"></hw-project-card>
        </div>
    </div>

    <!-- Project Modal -->
    <div *ngIf="isModalOpen" class="fixed inset-0 z-50 flex items-center justify-center bg-[rgba(31,41,55,0.5)]"
        (click)="closeModal()">
        <div class="relative p-4 w-full max-w-md max-h-full" (click)="$event.stopPropagation()">
            <div class="relative bg-white rounded-lg shadow p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-gray-900">
                        {{ selectedProject.id ? Messages.Headers.editProject : Messages.Headers.addProject }}
                    </h3>
                    <button type="button"
                        class="cursor-pointer end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center"
                        (click)="closeModal()">
                        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 14 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                        </svg>
                        <span class="sr-only">Close modal</span>
                    </button>
                </div>

                <!-- Modal Form -->
                <form #projectForm="ngForm" (ngSubmit)="onSave(projectForm.value)">
                    <!-- Title -->
                    <div class="mb-4">
                        <label for="title" class="block text-sm font-medium">{{Messages.Labels.title}}</label>
                        <input type="text" id="title" name="title" [(ngModel)]="selectedProject.title" required
                            class="mt-2 w-full bg-gray-50 border border-custom-300 text-gray-900 text-sm rounded-lg focus:ring-custom-500 focus:border-custom-500 block p-2.5" />

                        <div *ngIf="titleInvalid" class="text-red-600 text-sm mt-1">
                            {{Messages.Errors.projectTitleInvalid}}
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="mb-4">
                        <label for="description"
                            class="block text-sm font-medium">{{Messages.Labels.description}}</label>
                        <textarea id="description" name="description" [(ngModel)]="selectedProject.description" required
                            class="mt-2 bg-gray-50 border border-custom-300 text-gray-900 text-sm rounded-lg focus:ring-custom-500 focus:border-custom-500 block w-full p-2.5"
                            rows="3"></textarea>

                        <div *ngIf="descriptionInvalid" class="text-red-600 text-sm mt-1">
                            {{Messages.Errors.projectDescriptionInvalid}}
                        </div>
                    </div>

                    <!-- Preview Link -->
                    <div class="mb-4">
                        <label for="previewLink"
                            class="block text-sm font-medium">{{Messages.Labels.previewLink}}</label>
                        <input type="url" id="previewLink" name="previewLink" [(ngModel)]="selectedProject.previewLink"
                            class="mt-2 bg-gray-50 border border-custom-300 text-gray-900 text-sm rounded-lg focus:ring-custom-500 focus:border-custom-500 block w-full p-2.5"
                            dir="ltr" />

                        <div *ngIf="previewLinkInvalid" class="text-red-600 text-sm mt-1">
                            {{Messages.Errors.projectPreviewLinkInvalid}}
                        </div>
                    </div>

                    <!-- Download Link -->
                    <div class="mb-4">
                        <label for="downloadLink"
                            class="block text-sm font-medium">{{Messages.Labels.downloadLink}}</label>
                        <input type="url" id="downloadLink" name="downloadLink"
                            [(ngModel)]="selectedProject.downloadLink"
                            class="mt-2 bg-gray-50 border border-custom-300 text-gray-900 text-sm rounded-lg focus:ring-custom-500 focus:border-custom-500 block w-full p-2.5"
                            dir="ltr" />

                        <div *ngIf="downloadLinkInvalid" class="text-red-600 text-sm mt-1">
                            {{Messages.Errors.projectDownloadLinkInvalid}}
                        </div>
                    </div>

                    <!-- Image Upload -->
                    <div class="mb-4">
                        <div class="flex items-center space-x-4">
                            <label for="projectImage"
                                class="cursor-pointer px-4 py-2 bg-custom-500 text-white rounded-lg text-sm font-medium hover:bg-custom-400">
                                {{Messages.Buttons.selectImage}}
                            </label>
                            <span id="fileName" class="text-gray-700 text-sm"></span>
                        </div>


                        <input type="file" id="projectImage" name="projectImage" (change)="onImageSelected($event)"
                            accept="image/*" class="hidden" />

                        <div *ngIf="imageInvalid" class="text-red-600 text-sm mt-1">
                            {{Messages.Errors.projectImageInvalid}}
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="flex justify-end">
                        <button type="submit"
                            class="cursor-pointer w-full bg-custom-600 text-white px-4 py-2 rounded-lg hover:bg-custom-700 focus:ring focus:ring-custom-300">
                            {{ selectedProject.id ? Messages.Headers.edit : Messages.Buttons.add }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</ng-template>