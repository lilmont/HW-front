<div class="relative bg-custom-950 w-full py-10 md:py-20">
    <div class="w-full md:w-3/4 mx-auto text-white text-center md:text-right px-10 sm:px-0">
        <h1 class="xs:text-lg sm:text-2xl lg:text-3xl font-bold mb-6">
            {{courseDetail?.title}}
        </h1>
        <h3 class="xs:text-xs sm:text-md lg:text-lg leading-relaxed md:max-w-xs lg:max-w-3xl">
            {{courseDetail?.fullDescription}}
        </h3>
    </div>
</div>
<div class="flex flex-col md:block relative w-full">
    <!-- Vertical card with better layout -->
    <div
        class="order-1 md:order-none w-full md:absolute md:-top-60 lg:-top-40 md:left-20 lg:left-30 xl:left-40 md:w-1/4 md:rounded-2xl md:shadow-2xl overflow-hidden">
        <div class="relative w-full h-60 cursor-pointer" (click)="openVideoModal()" aria-label="Play Course Preview"
            role="button" tabindex="0" (keydown.enter)="openVideoModal()">
            <img *ngIf="courseDetail?.courseImage"
                [src]="baseUrl + '/uploads/courses/images/' + courseDetail?.courseImage" alt="Course preview"
                class="w-full h-full object-cover" />

            <!-- Play button overlay -->
            <div class="absolute inset-0 flex items-center justify-center bg-black/40 hover:bg-black/50 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M14.752 11.168l-6.286-3.657v7.314l6.286-3.657z" />
                </svg>
            </div>
        </div>

        <div class="relative p-4 flex flex-col gap-3 text-center bg-white">
            <div *ngIf="courseDetail?.hasDiscountCode" class="absolute top-2 right-0">
                <div class="relative w-[80px] h-8 z-10">
                    <div
                        class="absolute inset-0 bg-green-600 text-white text-xs font-bold flex items-center justify-center shadow-md rounded-bl-md rounded-tl-md">
                        {{Messages.Labels.discounted }}
                    </div>
                </div>
            </div>


            <div class="text-custom-600 font-medium text-sm">
                {{Messages.Headers.courseStatus}}
                <span class="font-semibold text-custom-800" [ngSwitch]="courseDetail?.courseStatus">
                    <span *ngSwitchCase="0">{{Messages.Headers.comingSoon}}</span>
                    <span *ngSwitchCase="1">{{Messages.Headers.InProgress}}</span>
                    <span *ngSwitchCase="2">{{Messages.Headers.completed}}</span>
                </span>
            </div>

            <div class="text-custom-600 font-medium text-sm">
                {{Messages.Headers.SessionCount}}
                <span class="font-semibold text-custom-800">
                    {{ courseDetail?.courseSessionNumber }}
                </span>
            </div>

            <div class="text-custom-600 font-medium text-sm">
                {{Messages.Headers.courseDuration}}
                <span class="font-semibold text-custom-800">
                    {{ courseDetail?.courseDurationInHours }}
                </span>
                <span class="mr-1">{{ Messages.Headers.hour }}</span>
            </div>

            <div class="text-custom-600 font-medium text-sm">
                {{Messages.Headers.price}}
                <span *ngIf="courseDetail?.hasDiscountCode; else normalPrice">
                    <span class="line-through text-red-500 ml-2">
                        {{ courseDetail?.price | number:'1.0-0' }}
                    </span>
                    <span class="font-semibold text-custom-800">
                        {{ courseDetail?.discountedPrice | number:'1.0-0' }}
                    </span>
                </span>
                <ng-template #normalPrice>
                    <span class="font-semibold text-custom-800">
                        {{ courseDetail?.price | number:'1.0-0' }}
                    </span>
                </ng-template>
                <span class="mr-1">{{ Messages.Headers.toman }}</span>
            </div>

            <button (click)="purchaseCoursePrep()"
                class="cursor-pointer mt-3 bg-custom-700 text-white text-sm py-2 px-4 rounded-md hover:bg-custom-800 transition">
                {{Messages.Buttons.purchaseCourse}}
            </button>
        </div>
    </div>

    <div class="order-2 md:order-none w-full md:w-3/4 mx-auto mt-10">
        <div class="w-full md:w-3/5 border-gray-200 md:rounded-lg md:shadow-lg px-7 sm:px-20 py-0 md:p-10">
            <h2 class="text-2xl font-bold mb-8">
                {{Messages.Headers.youWillLearn}}
            </h2>
            <div [innerHTML]="courseDetail?.syllabus"></div>
        </div>
    </div>
</div>

<!-- Course Video Modal -->
<div *ngIf="isVideoModalOpen" class="fixed inset-0 z-50 flex items-center justify-center bg-[rgba(31,41,55,0.5)]"
    (click)="closeVideoModal()">

    <!-- Modal content container -->
    <div class="relative p-4 w-full max-w-3xl max-h-full" (click)="$event.stopPropagation()">

        <!-- Modal box -->
        <div class="relative bg-white rounded-lg shadow-sm">

            <!-- Modal header -->
            <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t border-gray-200">
                <h3 class="text-xl text-gray-900">
                    {{courseDetail?.title}}
                </h3>
                <button type="button"
                    class="cursor-pointer text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 inline-flex justify-center items-center"
                    (click)="closeVideoModal()">
                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                    </svg>

                    <span class="sr-only">Close modal</span>
                </button>
            </div>

            <!-- Modal body: video -->
            <div class="p-4 md:p-5">
                <video controls class="w-full rounded-md max-h-[480px]"
                    [src]="baseUrl + '/uploads/courses/videos/' + courseDetail?.courseVideo" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>
    </div>
</div>

<!-- Login Modal -->
<div *ngIf="isLoginModalOpen" class="fixed inset-0 z-50 flex items-center justify-center bg-[rgba(31,41,55,0.6)]"
    (click)="closeLoginModal()" dir="rtl">
    <!-- Modal content container -->
    <div class="relative p-6 w-full max-w-md max-h-full bg-white rounded-lg shadow-lg"
        (click)="$event.stopPropagation()">
        <!-- Modal header -->
        <div class="flex items-center justify-between border-b border-gray-200 pb-3 mb-5">
            <h2 class="text-xl font-semibold text-gray-900">
                {{Messages.Errors.needAccount}}
            </h2>
            <button type="button" class="text-gray-400 hover:text-gray-900 rounded-lg focus:outline-none"
                (click)="closeLoginModal()" aria-label="Close modal">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <!-- Modal body -->
        <div class="text-center text-gray-700 mb-6">
            <p class="mb-2">{{ Messages.Errors.youNeedToLogin}}</p>
        </div>

        <!-- Action button -->
        <div class="flex justify-center">
            <button (click)="goToLoginSignup()"
                class="cursor-pointer bg-custom-600 hover:bg-custom-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-200">
                {{Messages.Headers.LoginOrSignup}}
            </button>
        </div>
    </div>
</div>

<!-- Charge Wallet Modal -->
<div *ngIf="isChargeWalletModalOpen" class="fixed inset-0 z-50 flex items-center justify-center bg-[rgba(31,41,55,0.6)]"
    (click)="closeChgargeWalletModal()" dir="rtl">
    <!-- Modal content container -->
    <div class="relative p-6 w-full max-w-md max-h-full bg-white rounded-lg shadow-lg"
        (click)="$event.stopPropagation()">
        <!-- Modal header -->
        <div class="flex items-center justify-between border-b border-gray-200 pb-3 mb-5">
            <h3 class="text-xl text-gray-900">
                {{Messages.Errors.notEnoughWalletBalance}}
            </h3>
            <button type="button" class="text-gray-400 hover:text-gray-900 rounded-lg focus:outline-none"
                (click)="closeChgargeWalletModal()" aria-label="Close modal">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <!-- Modal body -->
        <div class="text-center text-gray-700 mb-6">
            <p class="mb-2">
                {{ Messages.Errors.icreaseWalletBalance1 }}
                <span class="font-bold text-custom-600">
                    {{
                    (courseDetail?.hasDiscountCode ? courseDetail?.discountedPrice : courseDetail?.price) |
                    number:'1.0-0'
                    }}
                </span>
                {{ Messages.Errors.icreaseWalletBalance2 }}
            </p>
        </div>

        <!-- Action button -->
        <div class="flex justify-center">
            <button (click)="goToPayment()"
                class="cursor-pointer bg-custom-600 hover:bg-custom-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-200">
                {{Messages.Buttons.increaseBalance}}
            </button>
        </div>
    </div>
</div>

<!-- Purchase Confirmation Modal -->
<div *ngIf="isPurchaseConfirmationModalOpen"
    class="fixed inset-0 z-49 flex items-center justify-center bg-[rgba(31,41,55,0.5)]"
    (click)="closePurchaseConfirmationModal()">

    <!-- Modal content container -->
    <div class="relative bg-white rounded-lg shadow-lg w-full max-w-md p-6" (click)="$event.stopPropagation()">

        <!-- Modal header -->
        <div class="flex items-center justify-between border-b border-gray-200 pb-3 mb-5">
            <h3 class="text-xl text-gray-900">
                {{ Messages.Headers.areYouSure }}
            </h3>
            <button type="button" class="text-gray-400 hover:text-gray-900 rounded-lg focus:outline-none"
                (click)="closePurchaseConfirmationModal()" aria-label="Close modal">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <!-- Modal body -->
        <div class="text-gray-700 text-center mb-6">
            <p>{{ Messages.Warnings.alreadyPurchased }}</p>
        </div>

        <!-- Modal footer / buttons -->
        <div class="flex justify-end">
            <button (click)="closePurchaseConfirmationModal()"
                class="cursor-pointer px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg transition duration-200 ml-4">
                {{ Messages.Buttons.cancel }}
            </button>

            <button (click)="purchaseCourse()"
                class="cursor-pointer px-4 py-2 bg-custom-600 hover:bg-custom-700 text-white font-semibold rounded-lg shadow-md transition duration-200">
                {{ Messages.Buttons.purchaseCourse }}
            </button>
        </div>
    </div>
</div>